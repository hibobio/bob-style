<header *ngIf="allowedActions.add || allowedActions.sort"
        class="bel-header mrg-b-4">

  <div class="bel-header-top flx flx-row-align-y flx-wrap mrg-b-4"
       *ngIf="allowedActions.add">

    <b-button class="bel-plus-button"
              [button]="addButton"
              [hidden]="currentAction === 'add'"
              (clicked)="addItem()">
    </b-button>

    <div class="bel-item flx flx-row-align-y flx-grow b-body pad-x-16 bg-white rounded focused"
         [hidden]="currentAction !== 'add'">

      <input #addItemInput
             type="text"
             class="bfe-input bel-item-input flex-grow"
             [(ngModel)]="listState.newItem.value"
             [attr.autocomplete]="autoComplete.off"
             [attr.maxlength]="maxChars || null">

      <div class="bel-item-confirm"
           tabindex="0">
        <b-button class="bel-cancel-button"
                  [button]="cancelButton"
                  (clicked)="cancel('add')">
        </b-button>
        <b-button class="bel-done-button"
                  [button]="doneButton"
                  (clicked)="addItemApply()">
        </b-button>
      </div>

    </div>
  </div>

  <div class="bel-header-bottom flx flx-row-align-y mrg-b-16"
       [hidden]="!listState.list.length">

    <span class="bel-total">
      {{('common.total' | translate)}}: {{listState.list.length || 0}}
    </span>

    <b-button *ngIf="allowedActions.sort"
              class="bel-sort-button mrg-l-auto"
              [ngClass]="sortType===order.UserDefined?'clr-grey-700':'clr-grey-600'"
              [attr.data-sorting]="sortType"
              [button]="sortButton"
              [icon]="sortButton['icons'][sortType]"
              [text]="sortButton['texts'][sortType]"
              (clicked)="sortList()">
    </b-button>

  </div>

</header>

<div cdkDropList
     [cdkDropListDisabled]="allowedActions.order === false"
     (cdkDropListDropped)="onDrop($event)">

  <div *ngFor="let item of listState.list; let index = index; trackBy: listTrackBy"
       class="bel-item flx flx-row-align-y b-body pad-x-16 mrg-y-4 bg-white rounded has-hover"
       [@zoomInOut]
       [@.disabled]="!ready||!index"
       cdkDrag
       cdkDragLockAxis="y"
       [cdkDragData]="item"
       (cdkDragStarted)="onDragStart()"
       data-icon-before-size="medium"
       data-icon-before-color="light"
       [attr.data-icon-before]="allowedActions.order !== false ? 'drag-alt' : null"
       [attr.data-item-id]="item.id"
       [class.focused]="currentAction!=='order' && currentItemIndex === index">

    <span class="bel-item-value flx-grow"
          [hidden]="currentAction === 'edit' && currentItemIndex === index"
          data-max-lines="2">
      {{ item.value }}
    </span>

    <input #editItemInput
           type="text"
           class="bfe-input bel-item-input edit-input flex-grow"
           [(ngModel)]="item.value"
           [hidden]="currentAction !== 'edit' || currentItemIndex !== index"
           [attr.autocomplete]="autoComplete.off"
           [attr.maxlength]="maxChars || null">

    <ng-container *ngIf="!allowedActions.remove || !allowedActions.edit">
      <b-square-button *ngIf="allowedActions.remove && item.canBeDeleted!==false"
                       class="bel-item-action-btn mrg-l-auto"
                       [button]="deleteButton"
                       [hidden]="currentItemIndex===index"
                       (clicked)="removeItem(item, index)">
      </b-square-button>

      <b-square-button *ngIf="allowedActions.edit"
                       class="bel-item-action-btn mrg-l-auto"
                       [button]="editButton"
                       [hidden]="currentItemIndex===index"
                       (clicked)="editItem(item, index)">
      </b-square-button>
    </ng-container>

    <b-action-menu-button *ngIf="allowedActions.remove && allowedActions.edit"
                          class="bel-item-menu-btn"
                          [id]="(item.id||item.value)+'-menu'"
                          [swallow]="true"
                          [menuItems]="item.canBeDeleted!==false?menuItems:[menuItems[1]]"
                          [hidden]="currentItemIndex===index"
                          (openMenu)="cancel()"
                          (actionClick)="onMenuAction($event.key,item,index)">
    </b-action-menu-button>

    <div *ngIf="allowedActions.remove || allowedActions.edit"
         class="bel-item-confirm flx flx-row-align-y"
         tabindex="0"
         [hidden]="currentAction==='order' || currentItemIndex !== index">

      <b-button class="bel-cancel-button"
                [button]="cancelButton"
                (clicked)="cancel()">
      </b-button>

      <b-button class="bel-remove-button"
                [button]="removeButton"
                [hidden]="currentAction!=='remove'"
                (clicked)="removeItemApply(item, index)">
      </b-button>

      <b-button class="bel-done-button"
                [button]="doneButton"
                [hidden]="currentAction!=='edit'"
                (clicked)="editItemApply(item, index)">
      </b-button>

    </div>

    <ng-template cdkDragPreview
                 [data]="item"
                 [matchSize]="true">
      <div class="bel-item flx flx-row-align-y b-body pad-x-16 mrg-y-4 bg-white rounded bel-item-dragged"
           data-icon-before="drag-alt"
           data-icon-before-size="medium"
           data-icon-before-color="dark">
        <span class="bel-item-value flx-grow"
              data-max-lines="2">
          {{ item.value }}
        </span>
      </div>
    </ng-template>

  </div>

</div>
