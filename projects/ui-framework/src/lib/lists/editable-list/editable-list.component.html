<header *ngIf="allowedActions.add || allowedActions.sort"
        class="bel-header">

  <div class="bel-header-top"
       *ngIf="allowedActions.add">

    <b-button class="bel-plus-button"
              [hidden]="addingItem"
              [type]="buttonType.secondary"
              [size]="buttonSize.small"
              [icon]="icons.add"
              [text]="allowedActions.add!==true ? allowedActions.add : ('common.add' | translate)"
              (clicked)="addItem()">
    </b-button>

    <div class="bel-item focused"
         [hidden]="!addingItem"
         [ngClass]="{error: inputInvalid}">

      <input #addItemInput
             type="text"
             class="bfe-input bel-item-input"
             [attr.autocomplete]="autoComplete.off"
             [attr.maxlength]="maxChars || null"
             (input.outside-zone)="onInputChange()">

      <div class="bel-item-confirm"
           tabindex="0">
        <b-button class="bel-cancel-button"
                  [type]="buttonType.tertiary"
                  [size]="buttonSize.small"
                  [text]="('common.cancel' | translate)">
        </b-button>
        <b-button class="bel-done-button"
                  [type]="buttonType.secondary"
                  [size]="buttonSize.small"
                  [text]="('common.done' | translate)"
                  (clicked)="addItem(true)">
        </b-button>
      </div>

    </div>
  </div>

    <ng-container 
    *ngTemplateOutlet="errorMsg; context: {'showError': addingItemLen ,
     'hidden': !addingItem || !(inputInvalid || maxChars - addingItemLen < 15)}"></ng-container>

  <div class="bel-header-bottom">

    <span class="bel-total b-big-body">
      {{('common.total' | translate)}}: {{listState.list.length || 0}}
    </span>

    <b-button *ngIf="allowedActions.sort"
              class="bel-sort-button"
              [type]="buttonType.tertiary"
              [size]="buttonSize.small"
              [icon]="sortType === order.UserDefined || sortType === order.Asc ? icons.sort_asc :
              icons.sort_desc"
              [ngClass]="{'custom-sorting': sortType === order.UserDefined}"
              [throttle]="false"
              (clicked)="sortList()"
              [text]="sortType === order.Asc
                ? ('list-editor.editor.sortAsc' | translate) :
                  sortType === order.Desc ?
                  ('list-editor.editor.sortDesc' | translate) :
                  ('list-editor.editor.sortCustom' | translate)">
    </b-button>

  </div>

</header>

<div 
  [ngClass]="{'bel-has-item-dragged': isDragged}"
  cdkDropList
  (cdkDropListDropped)="onDrop($event)"
  >
  <ng-container *ngFor="let item of listState.list; let index = index; trackBy: listTrackBy">

    <div class="bel-item b-icon-medium b-icon-dark mrg-y-4"
         cdkDragPreviewClass="bel-item-dragged"
         (cdkDragStarted)="onDragStart()"
         cdkDrag cdkDragLockAxis="y"
         [attr.data-item-id]="item.id"
         [ngClass]="{'new': addedItem && index === 0,
                     'deleted':removedItem && itemHandledIndex === index,
                     'b-icon-drag-alt': allowedActions.order !== false,
                     error: editInputInvalid && index === itemHandledIndex,
                     'non-draggable-item': allowedActions.order === false}">

      <span [hidden]="isEditMode && index === itemHandledIndex" class="bel-item-value"
            data-max-lines="2">
        {{ item.value }}
      </span>

      <input #editItemInput
             type="text"
             [hidden]="!isEditMode || index !== itemHandledIndex"
             class="bfe-input bel-item-input edit-input"
             [attr.autocomplete]="autoComplete.off"
             [id]="index"
             [(ngModel)]="item.value"
             [attr.maxlength]="maxChars || null"
             (input.outside-zone)="onInputChange()">

      <b-square-button *ngIf="allowedActions.remove && item.canBeDeleted!==false && !isMultipleActions"
                       class="bel-trash-button"
                       [hidden]="itemHandledIndex === index"
                       [type]="buttonType.tertiary"
                       [size]="buttonSize.small"
                       [icon]="icons.delete"
                       (clicked)="removeItem(index)">
      </b-square-button>

      <b-square-button *ngIf="allowedActions.edit && !isMultipleActions"
                       class="bel-trash-button"
                       [hidden]="itemHandledIndex === index"
                       [type]="buttonType.tertiary"
                       [size]="buttonSize.small"
                       [icon]="icons.edit"
                       (clicked)="editItem(item, index)">
      </b-square-button>

      <div>
        <b-action-menu-button *ngIf="itemHandledIndex !== index && isMultipleActions"
          [menuItems]="this.initMenuItems(index, item)">
        </b-action-menu-button>
      </div>

      <div *ngIf="allowedActions.remove || allowedActions.edit"
           class="bel-item-confirm"
           [hidden]="itemHandledIndex !== index"
           tabindex="0">

        <b-button class="bel-cancel-button"
                  [type]="buttonType.tertiary"
                  [size]="buttonSize.small"
                  [text]="('common.cancel' | translate)"
                  (clicked)="itemHandledIndex = null">
        </b-button>
        <ng-container [ngSwitch]="currentActionType">
          <ng-container *ngSwitchCase="'remove'">
            <ng-container *ngTemplateOutlet="removeBtn; context: {'index': index}"></ng-container>
          </ng-container>
          <ng-container *ngSwitchCase="'edit'">
            <ng-container *ngTemplateOutlet="saveBtn; context: {'item': item}"></ng-container>
          </ng-container>
        </ng-container>
      </div>
  </div>
  <ng-container 
      *ngTemplateOutlet="errorMsg; context: {'showError': itemHandledIndex === index,
       'hidden': !currentEditInput || !(editInputInvalid || maxChars - addingItemLen < 15)}">
  </ng-container>
  </ng-container>

</div>

<ng-template #removeBtn let-index="index">
  <b-button class="bel-remove-button"
              [type]="buttonType.negative"
              [size]="buttonSize.small"
              [text]="('common.remove' | translate)"
              (clicked)="removeItem(index,true)">
  </b-button>
</ng-template>

<ng-template #saveBtn let-item="item">
  <b-button class="bel-done-button save-edit-btn"
              [type]="buttonType.secondary"
              [size]="buttonSize.small"
              [text]="('common.save' | translate)"
              (clicked)="saveEdit(item)">
    </b-button>
</ng-template>

<ng-template #errorMsg let-show="showError" let-hidden="hidden">
  <p b-input-message
      *ngIf="show"
      [hidden]="hidden"
      [errorMessage]="inputInvalid || editInputInvalid ? '&#34; ' + ('list-editor.editor.already-exists' | translate) : null"
      [maxChars]="maxChars - addingItemLen < 15 ? maxChars : null"
      [length]="addingItemLen">
  </p>
</ng-template>
