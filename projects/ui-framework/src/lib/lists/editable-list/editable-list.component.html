<header class="bel-header mrg-b-4">

  <div class="bel-header-top flx flx-row-align-y flx-wrap"
       *ngIf="allowedActions.add">

    <b-button class="bel-plus-button"
              [button]="addButton"
              [hidden]="state.currentAction === 'add'"
              [disabled]="state.searchValue"
              (clicked)="addItem()">
    </b-button>

    <div class="bel-item flx flx-row-align-y flx-grow b-body pad-x-16 bg-white rounded focused"
         [hidden]="state.currentAction !== 'add'">

      <input #addItemInput
             type="text"
             class="bfe-input bel-item-input flex-grow"
             [(ngModel)]="state.newItem.value"
             [attr.autocomplete]="autoComplete.off"
             [attr.maxlength]="maxChars || null">

      <div class="bel-item-confirm"
           tabindex="0">
        <b-button class="bel-cancel-button"
                  [button]="cancelButton"
                  (clicked)="cancel('add')">
        </b-button>
        <b-button class="bel-done-button"
                  [button]="doneButton"
                  (clicked)="addItemApply()">
        </b-button>
      </div>

    </div>
  </div>

  <div class="bel-header-bottom flx flx-row-align-y mrg-t-4 mrg-b-8"
       [hidden]="!state.list.length">

    <span class="bel-total mrg-r-8">
      {{('common.total' | translate)}}: {{state.list.length || 0}}
    </span>

    <b-compact-search class="mrg-l-auto"
                      [hidden]="state.list.length<=pagerMinItems"
                      [config]="searchConfig">
    </b-compact-search>

    <b-button *ngIf="allowedActions.sort"
              class="bel-sort-button"
              [class.mrg-l-auto]="state.list.length<=pagerMinItems"
              [ngClass]="sortType===order.UserDefined?'clr-grey-700':'clr-grey-600'"
              [attr.data-sorting]="sortType"
              [button]="sortButton"
              [icon]="sortButton['icons'][sortType]"
              [text]="sortButton['texts'][sortType]"
              [disabled]="state.searchValue"
              (clicked)="sortList()">
    </b-button>

  </div>

</header>

<div class="bel-item-list"
     cdkDropList
     [cdkDropListDisabled]="allowedActions.order ===
       false||!!state.searchValue">

  <div *ngLet="(state.currentItem||{}) as item"
       [style.grid-row]="state.hoverItemIndex+'/'+(state.hoverItemIndex+1)"
       [hidden]="state.hoverItemIndex===null"
       class="bel-item bel-item-edit flx flx-row-align-y b-body pad-x-16
         rounded"
       data-icon-before-size="medium"
       data-icon-before-color="normal"
       [attr.data-icon-before]="allowedActions.order !== false && !state.searchValue ? 'drag-alt' : null">

    <span class="flx-grow flx">
      <input #editItemInput
             type="text"
             class="bfe-input bel-item-input edit-input flx-grow"
             [(ngModel)]="item.value"
             [hidden]="state.currentAction !== 'edit' || state.currentItemIndex !== item.index"
             [attr.autocomplete]="autoComplete.off"
             [attr.maxlength]="maxChars || null">
    </span>

    <ng-container *ngIf="!allowedActions.remove || !allowedActions.edit">
      <b-square-button *ngIf="allowedActions.remove && item.canBeDeleted!==false"
                       class="bel-item-action-btn mrg-l-auto"
                       [button]="deleteButton"
                       (clicked)="removeItem(item, state.currentItemIndex)">
      </b-square-button>

      <b-square-button *ngIf="allowedActions.edit"
                       class="bel-item-action-btn mrg-l-auto"
                       [button]="editButton"
                       (clicked)="editItem(item, item.index)">
      </b-square-button>
    </ng-container>

    <b-action-menu-button *ngIf="allowedActions.remove && allowedActions.edit"
                          class="bel-item-menu-btn"
                          [id]="(item.id||item.value)+'-menu'"
                          [swallow]="true"
                          [menuItems]="item.canBeDeleted!==false?menuItems:menuItems.slice(1)"
                          [hidden]="state.currentItemIndex===item.index"
                          (openMenu)="cancel()"
                          (actionClick)="onMenuAction($event.key,item, item.index)">
    </b-action-menu-button>

    <div *ngIf="allowedActions.remove || allowedActions.edit"
         class="bel-item-confirm flx flx-row-align-y"
         tabitem.index="0"
         [hidden]="state.currentAction==='order' || state.currentItemIndex !== item.index">

      <b-button class="bel-cancel-button"
                [button]="cancelButton"
                (clicked)="cancel()">
      </b-button>

      <b-button class="bel-remove-button"
                [button]="removeButton"
                [hidden]="state.currentAction!=='remove'"
                (clicked)="removeItemApply(item, item.index)">
      </b-button>

      <b-button class="bel-done-button"
                [button]="doneButton"
                [hidden]="state.currentAction!=='edit'"
                (clicked)="editItemApply(item, item.index)">
      </b-button>

    </div>

  </div>

  <ng-container *ngIf="viewList$|async as viewList">
    <ng-container *ngFor="let e of emptyIterable;
                        let i = index; trackBy: '$index'|trackByProp">

      <ng-container *ngLet="(viewList[i]||{data:{}}) as item">
        <div class="bel-item flx flx-row-align-y b-body pad-x-16 bg-white rounded has-hover"
             [style.grid-row]="i+'/'+(i+1)"
             [hidden]="!viewList[i]"
             [@zoomInOut]
             [@.disabled]="!state.ready||(state.currentAction ===
         'remove'&&!item.index)"
             cdkDrag
             cdkDragLockAxis="y"
             [cdkDragData]="item"
             [cdkDragDisabled]="!viewList[i]"
             (cdkDragStarted)="onDragStart()"
             (cdkDragDropped)="onDrop($event, viewList)"
             data-icon-before-size="medium"
             data-icon-before-color="light"
             [attr.data-icon-before]="allowedActions.order !== false &&
             !state.searchValue ? 'drag-alt' : null"
             [attr.data-item-id]="item.data.id"
             [attr.data-item-index]="item.index"
             [attr.data-item-view-index]="i"
             [class.focused]="state.currentAction!=='order' && state.currentItemIndex === item.index">
          <span class="bel-item-value flx-grow"
                [hidden]="state.currentAction === 'edit' && state.currentItemIndex === item.index"
                data-max-lines="2"
                [innerHTML]="item.highlightedValue||item.data.value">
          </span>
        </div>
      </ng-container>

    </ng-container>
  </ng-container>

</div>


<b-pager class="mrg-t-16"
         [hidden]="state.list.length<=pagerMinItems"
         [config]="pagerConfig"></b-pager>
