<ng-template #listItem
             let-index="index"
             let-item="item">

  <li role="listitem"
      class="betl-item"
      [id]="item.id"
      [attr.data-index]="index"
      [attr.data-level]="item.parentCount || 1"
      tabindex="0"
      [ngClass]="{
        'btl-item-option': !item.childrenCount,
        'btl-item-group': item.childrenCount,
        expanded: item.childrenCount && !item.collapsed,
        collapsed: item.collapsed
      }">

    <span *ngIf="item.childrenCount"
          class="betl-item-chevron has-hover"></span>

    <b-menu [id]="item.id"
            [data]="item"
            [menu]="itemMenu">

      <b-icon menu-trigger
              role="button"
              class="betl-item-menu-trigger"
              [type]="iconType.circular"
              [size]="iconSize.small"
              [color]="iconColor.white"
              [icon]="icons.three_dots">
      </b-icon>

    </b-menu>

    <input [(ngModel)]="item.name"
           class="betl-item-input"
           type="text">
  </li>

</ng-template>

<ul #listElement
    role="list"
    class="betl-list"
    (click)="onListClick($event)"
    (keydown)="onListKeyDown($event)">

  <!-- of $listViewModel | async -->
  <ng-container *ngFor="let itemID of listViewModel; let index = index; trackBy: trackBy">
    <ng-container *ngTemplateOutlet="listItem; context: {
      index: index,
      item: itemsMap.get(itemID)
    }"></ng-container>
  </ng-container>

</ul>

<b-icon role="button"
        class="betl-list-add-item"
        [type]="iconType.circular"
        [size]="iconSize.small"
        [color]="iconColor.white"
        [icon]="icons.add"
        (click)="insertItem('lastChildOf', rootItem)">
</b-icon>


<div class="dev">
  <p>Total items: {{ itemsMap.size - 1 }}</p>
  <p>Total items in view: {{ listViewModel.length }}</p>

  <button type="button"
          (click)="log('Data')">Log data</button>

  <button type="button"
          (click)="log('ViewContext')">Log items View Context</button>

</div>
