<ul #listElement
    role="list"
    class="betl-list"
    cdkDropList
    [cdkDropListDisabled]="disableDragAndDrop"
    (cdkDropListDropped)="onItemDrop($event)"
    (click)="onListClick($event)"
    (keydown)="onListKeyDown($event)"
    (focusout)="onListBlur($event)">

  <ng-container *ngFor="let itemID of listViewModel; let index = index; trackBy: trackBy">
    <ng-container *ngTemplateOutlet="listItem; context: {
      index: index,
      item: itemsMap.get(itemID)
    }"></ng-container>

    <ng-template #listItem
                 let-index="index"
                 let-item="item">

      <li role="listitem" #dddddd
          *ngIf="!item.hidden"
          class="betl-item"
          cdkDrag
          [cdkDragDisabled]="disableDragAndDrop"
          [cdkDragData]="item"
          cdkDragLockAxis="y"
          [cdkDragBoundary]="listElement"
          [attr.data-id]="item.id"
          [attr.data-index]="index"
          [attr.data-level]="item.parentCount || 1"
          tabindex="0"
          [ngClass]="{
            'btl-item-option': !item.childrenCount,
            'btl-item-group': item.childrenCount,
            expanded: item.childrenCount && !item.collapsed,
            collapsed: item.collapsed
          }">

        <span *ngIf="item.childrenCount"
              class="betl-item-elmnt betl-item-chevron has-hover"
              role="button"></span>

        <b-menu class="betl-item-elmnt betl-item-menu"
                [id]="item.id"
                [data]="item"
                [menu]="itemMenu">
          <b-icon menu-trigger
                  role="button"
                  class="betl-item-menu-trigger"
                  [type]="iconType.circular"
                  [size]="iconSize.small"
                  [color]="iconColor.white"
                  [icon]="icons.three_dots">
          </b-icon>
        </b-menu>

        <span class="betl-item-elmnt betl-item-dot"
              cdkDragHandle
              aria-hidden="true"></span>

        <span class="betl-item-elmnt betl-item-input-wrap">
          <input [(ngModel)]="item.name"
                 #input
                 class="betl-item-input"
                 type="text">
        </span>

      </li>

    </ng-template>
  </ng-container>

</ul>

<div class="betl-list-footer">
  <b-icon role="button"
          class="betl-item-elmnt betl-list-add-item"
          [type]="iconType.circular"
          [size]="iconSize.small"
          [color]="iconColor.white"
          [icon]="icons.add"
          (click)="insertNewItem('lastChildOf', rootItem)">
  </b-icon>
</div>


<div *ngIf="debug"
     class="dev">
  <p>Total items: {{ itemsMap.size - 1 }}</p>
  <p>Total items in view: {{ listViewModel.length }}</p>

  <button type="button"
          (click)="clear()">Clear</button>

  <button type="button"
          (click)="log('Data')">Log data</button>

  <button type="button"
          (click)="log('New')">Log new</button>

  <button type="button"
          (click)="log('Deleted')">Log deleted</button>

  <button type="button"
          (click)="emitChange()">Emit</button>

</div>
