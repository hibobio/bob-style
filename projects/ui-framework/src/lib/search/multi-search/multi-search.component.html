<b-search [id]="id"
          [label]="label"
          [placeholder]="placeholder"
          (click)="openPanel()"
          (searchFocus)="openPanel()"
          (searchChange)="onSearchChange($event)"
          [ngClass]="{
              'panel-open': panelOpen,
              'panel-above': positionClassList['panel-above'],
              'panel-below': positionClassList['panel-below']
            }"
          cdkOverlayOrigin></b-search>

<ng-template #templateRef>
  <div class="b-select-panel"
       [ngClass]="positionClassList"
       (click.outside-zone)="onListClick($event)">
    <div class="bms-panel-scroll-container">

      <ul *ngFor="let group of searchOptionsViewModel; let groupIndex = index; trackBy: groupTrackBy"
          class="bms-group-list">

        <li class="bms-group">
          <h4 class="bms-group-title">
            {{ group[group.keyMap?.groupName || keyMapDef.groupName] }}
          </h4>

          <ul class="bms-option-list">
            <li *ngFor="let option of group[group.keyMap?.options || keyMapDef.options].slice(0,10); let optionIndex = index; trackBy: optionTrackBy(groupIndex, group)"
                class="bms-option"
                [attr.data-group-index]="groupIndex"
                [attr.data-option-index]="optionIndex">

              <b-component-renderer *ngIf="option.prefixComponent?.component"
                                    class="bms-option-prefix"
                                    [render]="option.prefixComponent"></b-component-renderer>

              <b-avatar-image *ngIf="option.icon && !option.prefixComponent"
                              class="bms-option-icon"
                              [icon]="{
                                icon: option.icon,
                                color: iconColor.white,
                                hasHoverState: true
                              }"
                              [size]="avatarSize.mini"
                              [backgroundColor]="iconBgColor">
              </b-avatar-image>

              <span class="bms-option-label"
                    *ngIf="option[group.keyMap?.label || keyMapDef.label]">
                {{ option[group.keyMap?.label || keyMapDef.label] }}
              </span>

              <span class="bms-option-value"
                    [innerHTML]="option[group.keyMap?.value || keyMapDef.value] | highlight: searchValue">
              </span>
            </li>
          </ul>
        </li>

      </ul>

    </div>
  </div>
</ng-template>
