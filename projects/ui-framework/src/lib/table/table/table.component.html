<div class="container">
  <div class="table">

    <table cdk-table #table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)" [matSortActive]="activeSort.name"
      [matSortDirection]="activeSort.sortActive" cdkDropList (cdkDropListDropped)="drop($event)">

      <ng-container cdkColumnDef="select" >
        <th cdk-header-cell *cdkHeaderCellDef >
          <mat-checkbox (change)="onSelectMaster($event)" [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()">
          </mat-checkbox>
        </th>
        <td cdk-cell *cdkCellDef="let row">
          <mat-checkbox (click)="$event.stopPropagation()" (change)="onSelectRow($event, row)" [checked]="selection.isSelected(row)">
          </mat-checkbox>
        </td>
      </ng-container>

      <ng-container *ngFor="let column of displayedColumns; let i = index" [cdkColumnDef]="column.name">
        <th cdk-header-cell *cdkHeaderCellDef mat-sort-header [disabled]="!column.isSort" >
          <div draggable="true">{{ column.name }} <button (click)="$event.stopPropagation(); removeColumnClicked(column)">X</button></div>

          <div *ngIf="column.type==='enum'">
            <button mat-button [matMenuTriggerFor]="menu">filter me</button>
            <mat-menu #menu="matMenu">
              <div *ngFor="let option of column.options">
                <mat-checkbox (change)="onColumnFilter(column, option, $event)" (click)="$event.stopPropagation()"
                  [checked]="option.selected">
                  {{option.displayName}}
                </mat-checkbox>
              </div>
            </mat-menu>

          </div>
        </th>
        <td cdk-cell *cdkCellDef="let row" (click)="rowClick(row)" (contextmenu)="rightClick(row)">
          <div *ngIf="column.type!=='component'">{{row[column.name]}}</div>
          <div *ngIf="column.type==='component'">
            <b-table-cell [row]="row" [column]="column" [data]="row[column.name].data"></b-table-cell>
          </div>
        </td>
      </ng-container>

      <cdk-header-row *matHeaderRowDef="col" ></cdk-header-row>
      <cdk-row *matRowDef="let row; columns: col;" ></cdk-row>
    </table>

  </div>
</div>