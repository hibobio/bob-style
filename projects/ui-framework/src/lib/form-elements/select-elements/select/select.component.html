<mat-form-field>

  <mat-select panelClass="select-element-panel"
              [multiple]="isMultiSelect"
              [placeholder]="placeholder"
              disableOptionCentering="true"
              disableRipple="true"
              [(ngModel)]="selectedModel"
              #mySelect>

    <mat-select-trigger>
      <span>___x___ {{triggerValue}}</span>
    </mat-select-trigger>

    <b-search [hideLabelOnFocus]="true"
              placeholder="Search"
              (keydown)="onSearchKeyDown($event)"
              (searchChange)="onSearchChange($event)">
    </b-search>

    <div class="options-wrapper"
         [ngClass]="{'no-grouping': selectionGroupOptions.length === 1 && !showSingleGroupHeader}">

      <div *ngFor="let group of selectionGroupOptions"
           class="group">

        <mat-option *ngIf="selectionGroupOptions.length > 1 || showSingleGroupHeader"
                    [value]="group.groupHeader"
                    (click)="onOptionClick(group.groupHeader)"
                    [disabled]="!isMultiSelect || blockGroupHeaderOptionClick"
                    class="group-header">
          <span class="option-value">{{group.groupHeader.value}}</span>
          <div class="collapse-group"
               [ngClass]="{'collapse': group.isCollapsed}"
               (mouseenter)="blockGroupHeaderOptionClick=true"
               (mouseleave)="blockGroupHeaderOptionClick=false"
               (click)="onCollapseGroup(group)">
          </div>
        </mat-option>

        <div *ngIf="!group.isCollapsed"
             class="group-options">
          <mat-option *ngFor="let option of group.options"
                      [value]="option"
                      (click)="onOptionClick(option)"
                      class="group-option">
            <span class="option-value">{{option.value}}</span>
          </mat-option>
        </div>

      </div>

    </div>

    <div *ngIf="isMultiSelect"
         fxLayout="row" fxLayoutAlign="end center"
         class="select-footer">
      <b-button (click)="cancelSelection()"
                class="cancel-button"
                size="{{buttonSize.small}}"
                type="{{buttonType.secondary}}">
        Cancel
      </b-button>
      <b-button (click)="notifySelectionIds()"
                class="apply-button"
                size="{{buttonSize.small}}"
                type="{{buttonType.primary}}">
        Apply
      </b-button>
    </div>
  </mat-select>

</mat-form-field>
